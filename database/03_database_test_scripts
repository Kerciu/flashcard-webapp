# -----------------------------------------------------------------
-- TRIGGERS

-- after_insert_customer_statistics
INSERT INTO Customers (email, password_hash, username, profile_creation_date, root_folder_id) 
VALUES ('test_user@example.com', 'hashedpassword', 'test_user', NOW(), 1);
-- verify the trigger
SELECT * FROM User_Statistics WHERE user_id = LAST_INSERT_ID();

-- before_insert_notification
INSERT INTO Notifications (user_id, received, text, received_date) 
VALUES (1, 0, 'Test Notification', NOW());
-- verify the trigger
SELECT creation_date FROM Notifications WHERE id = LAST_INSERT_ID();

--after_insert_customer_folder
INSERT INTO Customers (email, password_hash, username, profile_creation_date, root_folder_id) 
VALUES ('another_user@example.com', 'anotherhashedpassword', 'another_user', NOW(), 1);
-- verify the trigger
SELECT * FROM Folders WHERE name = CONCAT('Root Folder - ', 'another_user');
SELECT root_folder_id FROM Customers WHERE id = LAST_INSERT_ID();

----after_insert_friendship_notification
INSERT INTO Friendships (sender_id, receiver_id, accepted) 
VALUES (1, 2, 0);
-- verify the trigger
SELECT * FROM Notifications WHERE user_id = 2 AND text LIKE '%friend request from user ID: 1%';

# -----------------------------------------------------------------
-- FUNCTIONS
-- count_decks_new_cards_func
-- 1. count new flashcards in a deck for a user who has not reviewed any card yet
DECLARE
    result NUMBER;
BEGIN
    -- Assuming deckId = 1 and userId = 1
    result := count_decks_new_cards_func(1, 1);
    DBMS_OUTPUT.PUT_LINE('New Cards Count: ' || result); -- Expected: number of flashcards in deck 1 that the user hasn't reviewed
END;
-- 2. count new flashcards in a deck for a user who has reviewed all cards
DECLARE
    result NUMBER;
BEGIN
    -- Assuming deckId = 1 and userId = 2
    result := count_decks_new_cards_func(2, 1);
    DBMS_OUTPUT.PUT_LINE('New Cards Count: ' || result); -- Expected: 0, as the user has reviewed all cards in deck 1
END;


-- get_deck_progress_func
-- 1. User with 50% progress in a deck
DECLARE
    result FLOAT;
BEGIN
    -- Assuming userId = 1 and deckId = 1
    result := get_deck_progress__func(1, 1);
    DBMS_OUTPUT.PUT_LINE('Deck Progress: ' || result); -- Expected: 50%
END;
-- 2. User has not learned any flashcards in a deck
DECLARE
    result FLOAT;
BEGIN
    -- Assuming userId = 2 and deckId = 1
    result := get_deck_progress_func(2, 1);
    DBMS_OUTPUT.PUT_LINE('Deck Progress: ' || result); -- Expected: 0
-- 3. Deck with no flashcards
DECLARE
    result FLOAT;
BEGIN
    -- Assuming userId = 1 and deckId = 999 (no cards in deck 999)
    result := get_deck_progress_func(1, 999);
    DBMS_OUTPUT.PUT_LINE('Deck Progress: ' || result); -- Expected: 0
END;
